<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CINEPALETTE: Time Attack</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* --- TASARIM --- */
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #e0e0e0; text-align: center; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; user-select: none; }
        .screen { display: none; width: 95%; max-width: 550px; padding: 20px; background: #1a1a1a; border-radius: 16px; margin-top: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 1px solid #333; }
        .active { display: flex; flex-direction: column; align-items: center; }
        
        h1 { color: #FFD700; margin-bottom: 5px; font-size: 28px; letter-spacing: 3px; text-transform: uppercase; }
        .subtitle { color: #888; font-size: 13px; margin-bottom: 20px; letter-spacing: 1px; }

        /* Formlar */
        input, select { width: 100%; padding: 14px; margin: 8px 0; border-radius: 8px; border: 1px solid #444; background: #2a2a2a; color: #fff; outline: none; font-size: 16px; }
        input:focus, select:focus { border-color: #FFD700; background: #333; }
        
        button { width: 100%; padding: 16px; margin-top: 15px; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: #FFD700; color: #000; }
        .btn-primary:hover { background: #ffea70; transform: translateY(-2px); }
        .btn-secondary { background: #444; color: #fff; }
        
        /* Oyun ƒ∞√ßi √úst Bar */
        .top-bar { display: flex; justify-content: space-between; width: 100%; margin-bottom: 15px; padding: 10px; background: #252525; border-radius: 8px; font-weight: bold; font-size: 18px; }
        .timer-box { color: #FFD700; }
        .timer-box.critical { color: #ff4444; animation: pulse 0.5s infinite; }
        
        /* Renk ve Poster Alanƒ± */
        .palette-container { display: flex; width: 100%; height: 90px; border: 2px solid #555; margin-bottom: 15px; border-radius: 8px; overflow: hidden; }
        .color-box { flex: 1; height: 100%; }
        
        #poster-container { display: none; justify-content: center; margin-bottom: 15px; position: relative; }
        #game-poster { width: 150px; height: 220px; object-fit: cover; border-radius: 8px; border: 3px solid #fff; filter: blur(15px); transition: filter 0.5s ease; }
        
        /* ≈ûƒ±klar */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        .option-btn { padding: 14px; background: #2d2d2d; color: #ccc; border: 1px solid #444; border-radius: 6px; cursor: pointer; font-size: 14px; transition: 0.2s; display: flex; align-items: center; justify-content: center; min-height: 60px; }
        .option-btn:hover { background: #3d3d3d; }
        
        .correct { background: #28a745 !important; color: #fff !important; border-color: #28a745 !important; }
        .wrong { background: #dc3545 !important; color: #fff !important; border-color: #dc3545 !important; opacity: 0.6; }
        
        /* Animasyonlar */
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        /* Tablo */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
        th { color: #FFD700; font-size: 14px; }
        tr:first-child td { color: #FFD700; font-weight: bold; font-size: 18px; } /* 1. Oyuncu */
        
        .loader { border: 4px solid #333; border-top: 4px solid #FFD700; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="screen-login" class="screen active">
        <h1>CINEPALETTE</h1>
        <p class="subtitle">Time Attack Edition</p>
        
        <input type="text" id="username" placeholder="Oyuncu Adƒ±">
        
        <div style="background: #222; padding: 15px; border-radius: 10px; margin: 20px 0; width: 100%; box-sizing: border-box; border: 1px solid #333;">
            <h3 style="margin:0 0 10px 0; color:#FFD700; text-align:left; font-size:16px;">ODA KUR</h3>
            <label style="display:block; text-align:left; color:#888; font-size:12px;">Mod Se√ß:</label>
            <select id="category-select">
                <option value="mix">üé≤ Karƒ±≈üƒ±k (60sn)</option>
                <option value="director">üé¨ Y√∂netmenler (90sn) [ZOR]</option>
                <option value="poster_blur">üñºÔ∏è Bulanƒ±k Posterler (60sn)</option>
                <option value="horror">üëª Korku (60sn)</option>
                <option value="scifi">üöÄ Bilim Kurgu (60sn)</option>
            </select>
            <button class="btn-primary" onclick="createRoom()">ODA OLU≈ûTUR</button>
        </div>

        <div style="display:flex; align-items:center; gap:10px; margin: 15px 0;">
            <hr style="flex:1; border-color:#333"> <span style="color:#555; font-size:12px">VEYA</span> <hr style="flex:1; border-color:#333">
        </div>

        <input type="text" id="room-code-input" placeholder="Oda Kodu">
        <button class="btn-secondary" onclick="joinRoom()">ODAYA KATIL</button>
    </div>

    <div id="screen-lobby" class="screen">
        <h2 style="margin-top:0">LOBƒ∞</h2>
        <div style="background:#333; padding:5px 10px; border-radius:4px; color:#FFD700; font-size:14px; margin-bottom:10px;" id="lobby-info">...</div>
        
        <div style="border: 2px dashed #444; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <div style="color:#888; font-size:12px">ODA KODU</div>
            <div style="font-size: 32px; color: #28a745; font-family: monospace; letter-spacing: 5px;" id="display-room-code">----</div>
        </div>
        
        <ul id="player-list" style="list-style:none; padding:0; width:100%"></ul>
        
        <div id="host-controls" style="display:none; width:100%">
            <button class="btn-primary" onclick="startGameByHost()">HERKES ƒ∞√áƒ∞N BA≈ûLAT</button>
        </div>
        <p id="guest-msg" style="color:#666; font-size:12px; animation: pulse 2s infinite;">Oda sahibi bekleniyor...</p>
    </div>

    <div id="screen-game" class="screen">
        <div class="top-bar">
            <div class="timer-box" id="game-timer">60</div>
            <div id="game-score" style="color:#fff">0 Puan</div>
        </div>
        
        <div class="palette-container" id="palette-box"></div>

        <div id="poster-container">
            <img id="game-poster" src="" alt="Movie Poster">
        </div>

        <div class="options-grid" id="options-box"></div>
        <div id="game-feedback" style="height:20px; font-weight:bold; margin-top:10px; font-size:14px;"></div>
    </div>

    <div id="screen-waiting" class="screen">
        <h2>S√úRE DOLDU!</h2>
        <div class="loader"></div>
        <p id="waiting-status" style="color:#aaa">Sonu√ßlar senkronize ediliyor...</p>
    </div>

    <div id="screen-result" class="screen">
        <h1>üèÜ Lƒ∞DERLƒ∞K TABLOSU</h1>
        <table id="leaderboard-table">
            <thead><tr><th>#</th><th>Oyuncu</th><th>Puan</th></tr></thead>
            <tbody></tbody>
        </table>
        <button class="btn-secondary" onclick="location.reload()">ANA MEN√ú</button>
    </div>

    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyCKXuqXEtQ_dr1FNw-8NZj0BpeoSDl_mRY",
  authDomain: "cinepalette-e7a2b.firebaseapp.com",
  databaseURL: "https://cinepalette-e7a2b-default-rtdb.firebaseio.com",
  projectId: "cinepalette-e7a2b",
  storageBucket: "cinepalette-e7a2b.firebasestorage.app",
  messagingSenderId: "933599264840",
  appId: "1:933599264840:web:667563470c4ea338f7187d"
};

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // -------------------------------------------------------
        // GENƒ∞≈ûLETƒ∞LMƒ∞≈û VERƒ∞TABANI (50+ SORU & Y√ñNETMEN MODU)
        // -------------------------------------------------------
        const allQuestions = [
            // --- Y√ñNETMENLER (Zorlu ≈ûa≈üƒ±rtmacalar) ---
            { category: "director", colors: ["#000000", "#0D2615", "#00FF41", "#FFFFFF"], correct: "Wachowskis - The Matrix", options: ["Wachowskis - The Matrix", "Wachowskis - Cloud Atlas", "Ridley Scott - Alien", "Nolan - Inception"] },
            { category: "director", colors: ["#F29FCD", "#581845", "#86C0D7", "#F2E9D8"], correct: "Wes Anderson - GB Hotel", options: ["Wes Anderson - GB Hotel", "Wes Anderson - French Dispatch", "Wes Anderson - Asteroid City", "Tim Burton - Alice"] },
            { category: "director", colors: ["#FFD700", "#000000", "#FF0000", "#FFFFFF"], correct: "Tarantino - Kill Bill", options: ["Tarantino - Kill Bill", "Tarantino - Pulp Fiction", "Tarantino - Django", "Scorsese - Taxi Driver"] },
            { category: "director", colors: ["#000000", "#1C2833", "#F4D03F", "#FFFFFF"], correct: "C. Nolan - Interstellar", options: ["C. Nolan - Interstellar", "C. Nolan - Tenet", "C. Nolan - Inception", "Kubrick - 2001"] },
            { category: "director", colors: ["#0d1b2a", "#415a77", "#778da9", "#e0e1dd"], correct: "J. Cameron - Titanic", options: ["J. Cameron - Titanic", "J. Cameron - Avatar", "J. Cameron - Abyss", "Spielberg - Jaws"] },
            { category: "director", colors: ["#2E86C1", "#17202A", "#2ECC71", "#FFFFFF"], correct: "J. Cameron - Avatar", options: ["J. Cameron - Avatar", "J. Cameron - Titanic", "George Lucas - Star Wars", "J.J. Abrams - Star Trek"] },
            { category: "director", colors: ["#922B21", "#17202A", "#F1948A", "#D7DBDD"], correct: "D. Fincher - Fight Club", options: ["D. Fincher - Fight Club", "D. Fincher - Se7en", "D. Fincher - Gone Girl", "Tarantino - Reservoir Dogs"] },
            { category: "director", colors: ["#D35400", "#F5B041", "#17202A", "#FDFEFE"], correct: "S. Kubrick - The Shining", options: ["S. Kubrick - The Shining", "S. Kubrick - Clockwork Orange", "Hitchcock - Psycho", "Carpenter - Halloween"] },
            { category: "director", colors: ["#F1C40F", "#E67E22", "#FFFFFF", "#27AE60"], correct: "Ari Aster - Midsommar", options: ["Ari Aster - Midsommar", "Ari Aster - Hereditary", "Robert Eggers - The Witch", "Jordan Peele - Nope"] },
            { category: "director", colors: ["#1C2833", "#5D6D7E", "#E74C3C", "#FDFEFE"], correct: "Spielberg - Schindler's List", options: ["Spielberg - Schindler's List", "Spielberg - Saving Private Ryan", "Polanski - The Pianist", "Nolan - Dunkirk"] },

            // --- BULANIK POSTERLER ---
            { category: "poster_blur", colors: ["#1C1C1C", "#C0392B", "#F1C40F", "#ECF0F1"], correct: "The Truman Show", posterUrl: "https://upload.wikimedia.org/wikipedia/en/c/cd/Trumanshow.jpg", options: ["The Truman Show", "Eternal Sunshine", "Liar Liar", "Forrest Gump"] },
            { category: "poster_blur", colors: ["#000000", "#FFD700", "#8B0000", "#FFFFFF"], correct: "The Godfather", posterUrl: "https://upload.wikimedia.org/wikipedia/en/1/1c/Godfather_ver1.jpg", options: ["The Godfather", "Scarface", "Goodfellas", "Irishman"] },
            { category: "poster_blur", colors: ["#1a1a1a", "#3e3e3e", "#b0b0b0", "#ffffff"], correct: "Pulp Fiction", posterUrl: "https://upload.wikimedia.org/wikipedia/en/3/3b/Pulp_Fiction_%281994%29_poster.jpg", options: ["Pulp Fiction", "Reservoir Dogs", "Kill Bill", "Snatch"] },
            { category: "poster_blur", colors: ["#2C3E50", "#E74C3C", "#3498DB", "#F1C40F"], correct: "Spider-Man", posterUrl: "https://upload.wikimedia.org/wikipedia/en/f/f3/Spider-Man2002Poster.jpg", options: ["Spider-Man", "Iron Man", "Daredevil", "X-Men"] },
            { category: "poster_blur", colors: ["#000000", "#2ECC71", "#17202A", "#FFFFFF"], correct: "Matrix", posterUrl: "https://upload.wikimedia.org/wikipedia/en/c/c1/The_Matrix_Poster.jpg", options: ["Matrix", "Blade Runner", "Tron", "Equilibrium"] },
            { category: "poster_blur", colors: ["#0E1523", "#3A5F85", "#BFD3E3", "#FFFFFF"], correct: "Frozen", posterUrl: "https://upload.wikimedia.org/wikipedia/en/0/05/Frozen_%282013_film%29_poster.jpg", options: ["Frozen", "Tangled", "Moana", "Cinderella"] },

            // --- KORKU ---
            { category: "horror", colors: ["#000000", "#8B0000", "#FF4500", "#FFFFFF"], correct: "The Shining", options: ["The Shining", "It", "Misery", "Carrie"] },
            { category: "horror", colors: ["#1B4F72", "#111111", "#145A32", "#99A3A4"], correct: "Alien", options: ["Alien", "Predator", "The Thing", "Life"] },
            { category: "horror", colors: ["#FFFFFF", "#FF0000", "#FFFF00", "#000000"], correct: "It", options: ["It", "Joker", "Poltergeist", "Clown"] },
            { category: "horror", colors: ["#000000", "#5F6A6A", "#FDFEFE", "#922B21"], correct: "Psycho", options: ["Psycho", "Birds", "Vertigo", "Scream"] },
            
            // --- Bƒ∞Lƒ∞M KURGU ---
            { category: "scifi", colors: ["#F5DEB3", "#C2B280", "#8B4513", "#000000"], correct: "Dune", options: ["Dune", "Mad Max", "Star Wars", "Martian"] },
            { category: "scifi", colors: ["#F28C0F", "#003B59", "#A67A53", "#0D0D0D"], correct: "Blade Runner 2049", options: ["Blade Runner 2049", "Tron", "Oblivion", "Dune"] },
            { category: "scifi", colors: ["#000000", "#1C2833", "#F4D03F", "#FFFFFF"], correct: "Interstellar", options: ["Interstellar", "Gravity", "Arrival", "Contact"] },
            
            // --- KARI≈ûIK ƒ∞√áƒ∞N DOLGU ---
            { category: "mix", colors: ["#4B8BBE", "#FFD43B", "#FFFFFF", "#000000"], correct: "Minions", options: ["Minions", "Simpsons", "Spongebob", "Pokemon"] },
            { category: "mix", colors: ["#E0218A", "#F5BDD6", "#40E0D0", "#FFFDD0"], correct: "Barbie", options: ["Barbie", "Mean Girls", "Legally Blonde", "Clueless"] },
            { category: "mix", colors: ["#8A1C26", "#D98F25", "#1C3F38", "#000000"], correct: "Joker", options: ["Joker", "Iron Man", "The Batman", "Halloween"] },
            { category: "mix", colors: ["#102C54", "#4B367C", "#222222", "#185A8C"], correct: "La La Land", options: ["La La Land", "Moonlight", "Chicago", "Whiplash"] }
        ];

        // --- DEƒûƒ∞≈ûKENLER ---
        let myName="", myRoomCode="", myId="", isHost=false;
        let gameQuestions = [];
        let currentQIndex = 0;
        let score = 0;
        let gameTimerInterval;
        let totalTime = 60; // Varsayƒ±lan
        let isPlaying = false;

        // --- FONKSƒ∞YONLAR ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        function generateCode() { return Math.floor(1000 + Math.random() * 9000).toString(); }
        function getCategoryInfo(key) {
            const infos = { 
                "mix": "Karƒ±≈üƒ±k (60sn)", 
                "director": "Y√∂netmenler (90sn)", 
                "poster_blur": "Bulanƒ±k Poster (60sn)", 
                "horror": "Korku (60sn)", 
                "scifi": "Bilim Kurgu (60sn)" 
            };
            return infos[key] || "Bilinmiyor";
        }

        // --- ODA Y√ñNETƒ∞Mƒ∞ ---
        function createRoom() {
            myName = document.getElementById('username').value.trim();
            const cat = document.getElementById('category-select').value;
            if(!myName) return alert("ƒ∞sim giriniz!");
            
            myRoomCode = generateCode(); isHost = true;
            db.ref('rooms/' + myRoomCode).set({ status: "lobby", category: cat, createdAt: Date.now() });
            joinMyOwnRoom();
        }

        function joinRoom() {
            myName = document.getElementById('username').value.trim();
            myRoomCode = document.getElementById('room-code-input').value.trim();
            if(!myName || !myRoomCode) return alert("Bilgiler eksik!");
            
            db.ref('rooms/' + myRoomCode).get().then(snap => {
                if(snap.exists() && snap.val().status === "lobby") joinMyOwnRoom();
                else alert("Oda yok veya oyun ba≈ülamƒ±≈ü!");
            });
        }

        function joinMyOwnRoom() {
            const pRef = db.ref(`rooms/${myRoomCode}/players`).push();
            myId = pRef.key;
            pRef.set({ name: myName, score: 0, status: "waiting" });
            setupLobby();
        }

        function setupLobby() {
            showScreen('screen-lobby');
            document.getElementById('display-room-code').innerText = myRoomCode;
            if(isHost) document.getElementById('host-controls').style.display = 'block';
            else document.getElementById('guest-msg').style.display = 'block';

            const roomRef = db.ref('rooms/' + myRoomCode);
            roomRef.child('players').on('value', snap => {
                const list = document.getElementById('player-list'); list.innerHTML = '';
                if(snap.val()) Object.values(snap.val()).forEach(p => {
                    list.innerHTML += `<li style="background:#222; margin:5px; padding:10px; border-radius:5px; display:flex; justify-content:space-between;"><span>${p.name}</span><span>${p.score} P</span></li>`;
                });
            });

            roomRef.once('value').then(snap => {
                document.getElementById('lobby-info').innerText = "Mod: " + getCategoryInfo(snap.val().category);
            });

            roomRef.child('status').on('value', snap => {
                if(snap.val() === 'playing') {
                    roomRef.child('category').once('value').then(c => startGame(c.val()));
                } else if(snap.val() === 'finished') showFinalResults();
            });
        }

        function startGameByHost() { db.ref('rooms/' + myRoomCode).update({ status: "playing" }); }

        // -------------------------------------------------------
        // OYUN MOTORU (TIME ATTACK)
        // -------------------------------------------------------
        function startGame(catKey) {
            // 1. Sorularƒ± Hazƒ±rla
            if (catKey === 'mix') {
                gameQuestions = allQuestions.sort(() => Math.random() - 0.5);
                totalTime = 60;
            } else if (catKey === 'director') {
                // Y√∂netmen modunda sadece y√∂netmen sorularƒ±
                gameQuestions = allQuestions.filter(q => q.category === 'director').sort(() => Math.random() - 0.5);
                totalTime = 90; // Y√∂netmen modu i√ßin 90 saniye
            } else {
                gameQuestions = allQuestions.filter(q => q.category === catKey).sort(() => Math.random() - 0.5);
                totalTime = 60;
            }

            // Yedekleme: Eƒüer soru biterse ba≈üa sarsƒ±n diye sonsuz d√∂ng√º i√ßin array kopyalama mantƒ±ƒüƒ±
            // ≈ûimdilik 50 soru yetecektir ama gerekirse index kontrol√º yapƒ±lƒ±r.

            if(gameQuestions.length === 0) { alert("Yeterli soru yok!"); return; }

            showScreen('screen-game');
            currentQIndex = 0; score = 0; isPlaying = true;
            
            // GLOBAL SAYACI BA≈ûLAT
            startGlobalTimer();
            loadQuestion();
        }

        function startGlobalTimer() {
            const timerEl = document.getElementById('game-timer');
            timerEl.innerText = totalTime;
            timerEl.classList.remove('critical');

            gameTimerInterval = setInterval(() => {
                totalTime--;
                timerEl.innerText = totalTime;
                
                if(totalTime <= 10) timerEl.classList.add('critical');

                if(totalTime <= 0) {
                    finishGameLocal();
                }
            }, 1000);
        }

        function loadQuestion() {
            // Eƒüer s√ºre bitmediyse ve sorular bittiyse ba≈üa d√∂n
            if(currentQIndex >= gameQuestions.length) currentQIndex = 0;

            const q = gameQuestions[currentQIndex];
            const pBox = document.getElementById('palette-box');
            const oBox = document.getElementById('options-box');
            const postCont = document.getElementById('poster-container');
            const postImg = document.getElementById('game-poster');

            pBox.innerHTML = ''; oBox.innerHTML = ''; 
            document.getElementById('game-feedback').innerText = '';

            // Renkler
            q.colors.forEach(c => {
                const div = document.createElement('div');
                div.className = 'color-box'; div.style.backgroundColor = c;
                pBox.appendChild(div);
            });

            // Poster var mƒ±?
            if(q.posterUrl) {
                postCont.style.display = 'flex';
                postImg.src = q.posterUrl;
                postImg.style.filter = "blur(15px)"; // Her soruda reset
            } else {
                postCont.style.display = 'none';
            }

            // ≈ûƒ±klar
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn'; btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, q.correct, btn, q.posterUrl);
                oBox.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btn, hasPoster) {
            if(!isPlaying) return;
            
            // Diƒüer butonlarƒ± kitleme, hƒ±zlƒ± oyun i√ßin
            const all = document.querySelectorAll('.option-btn');
            all.forEach(b => b.disabled = true);

            if(hasPoster) document.getElementById('game-poster').style.filter = "blur(0px)";

            const fb = document.getElementById('game-feedback');

            if(selected === correct) {
                btn.classList.add('correct');
                score += 10;
                document.getElementById('game-score').innerText = score + " Puan";
                fb.innerText = "DOƒûRU! (+10)";
                fb.style.color = "#28a745";
                
                // Hƒ±zlƒ± ge√ßi≈ü
                setTimeout(() => {
                    if(isPlaying) { currentQIndex++; loadQuestion(); }
                }, 500);
            } else {
                btn.classList.add('wrong');
                fb.innerText = "YANLI≈û!";
                fb.style.color = "#dc3545";
                
                // Hƒ±zlƒ± ge√ßi≈ü (Puan yok, zaman cezasƒ± yok, sadece soru ka√ßtƒ±)
                setTimeout(() => {
                    if(isPlaying) { currentQIndex++; loadQuestion(); }
                }, 500);
            }
        }

        function finishGameLocal() {
            isPlaying = false;
            clearInterval(gameTimerInterval);
            
            // Puanƒ± g√∂nder
            db.ref(`rooms/${myRoomCode}/players/${myId}`).update({ score: score, status: "finished" });
            
            showScreen('screen-waiting');
            
            const pRef = db.ref(`rooms/${myRoomCode}/players`);
            pRef.on('value', snap => {
                const arr = Object.values(snap.val());
                const fin = arr.filter(p => p.status === "finished").length;
                document.getElementById('waiting-status').innerText = `${fin} / ${arr.length} ki≈üi tamamladƒ±.`;
                
                if(isHost && fin === arr.length) {
                    setTimeout(() => { db.ref('rooms/' + myRoomCode).update({ status: "finished" }); }, 1000);
                }
            });
        }

        function showFinalResults() {
            showScreen('screen-result');
            const tbody = document.querySelector('#leaderboard-table tbody'); tbody.innerHTML = '';
            
            db.ref(`rooms/${myRoomCode}/players`).once('value').then(snap => {
                const players = Object.values(snap.val());
                players.sort((a, b) => b.score - a.score);
                
                players.forEach((p, i) => {
                    tbody.innerHTML += `<tr style="${i===0?'background:#333':''}">
                        <td>${i+1}</td>
                        <td>${p.name}</td>
                        <td style="color:${i===0?'#FFD700':'#fff'}">${p.score}</td>
                    </tr>`;
                });
            });
        }
    </script>
</body>
</html>