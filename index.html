<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CINEPALETTE: Cinephile Edition</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* --- GENEL TASARIM --- */
        body { font-family: 'Courier New', Courier, monospace; background: #0a0a0a; color: #dcdcdc; text-align: center; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; user-select: none; }
        
        .screen { display: none; width: 95%; max-width: 600px; padding: 25px; background: #141414; border: 1px solid #333; margin-top: 20px; box-shadow: 0 0 50px rgba(0,0,0,0.9); }
        .active { display: flex; flex-direction: column; align-items: center; }
        
        h1 { color: #e50914; margin-bottom: 5px; font-size: 32px; letter-spacing: -1px; text-transform: uppercase; text-shadow: 0 0 10px rgba(229, 9, 20, 0.5); }
        .subtitle { color: #666; font-size: 12px; margin-bottom: 25px; letter-spacing: 2px; text-transform: uppercase; }

        /* Formlar */
        label { display: block; width: 100%; text-align: left; color: #888; font-size: 12px; margin-top: 10px; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; background: #222; border: 1px solid #444; color: #fff; outline: none; font-family: inherit; }
        input:focus, select:focus { border-color: #e50914; }
        
        button { width: 100%; padding: 15px; margin-top: 20px; background: #e50914; color: #fff; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }
        button:hover { background: #b20710; }
        button:disabled { background: #333; color: #666; cursor: not-allowed; }

        /* Oyun Alanƒ± */
        .top-bar { display: flex; justify-content: space-between; width: 100%; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .timer-box { font-size: 24px; color: #fff; font-weight: bold; }
        .timer-box.critical { color: #e50914; animation: shake 0.5s infinite; }
        
        /* Poster & Renkler */
        .visual-area { display: flex; gap: 10px; width: 100%; margin-bottom: 20px; height: 200px; }
        
        /* POSTER AYARLARI (Blur Fix) */
        #poster-wrapper { flex: 1; position: relative; overflow: hidden; border: 1px solid #333; background: #000; }
        #game-poster { 
            width: 100%; height: 100%; object-fit: cover; 
            /* Varsayƒ±lan olarak bulanƒ±k ba≈ülar - CSS tabanlƒ± olduƒüu i√ßin flash yapmaz */
            filter: blur(20px) grayscale(50%); 
            transform: scale(1.1); /* Blur kenarlarƒ± beyazlatmasƒ±n diye biraz zoom */
            transition: filter 1.5s ease, transform 1.5s ease, grayscale 1.5s ease;
            opacity: 0; /* Y√ºklenene kadar gizli */
            animation: fadeIn 0.5s forwards; 
        }
        #game-poster.revealed { filter: blur(0px) grayscale(0%); transform: scale(1); }

        .palette-column { width: 60px; display: flex; flex-direction: column; border: 1px solid #333; }
        .color-box { flex: 1; width: 100%; }
        
        /* ≈ûƒ±klar */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        .option-btn { padding: 15px; background: #1f1f1f; color: #aaa; border: 1px solid #333; cursor: pointer; font-size: 13px; transition: 0.2s; min-height: 60px; display: flex; align-items: center; justify-content: center; }
        .option-btn:hover { background: #333; color: #fff; border-color: #fff; }
        
        .correct { background: #1b5e20 !important; color: #fff !important; border-color: #4caf50 !important; }
        .wrong { background: #b71c1c !important; color: #fff !important; border-color: #f44336 !important; opacity: 0.5; }

        /* Animasyonlar */
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } 100% { transform: translateX(0); } }
        @keyframes fadeIn { to { opacity: 1; } }

        /* Tablo */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th { text-align: left; color: #888; border-bottom: 1px solid #333; padding: 10px; }
        td { padding: 10px; border-bottom: 1px solid #222; }
        tr:first-child td { color: #e50914; font-weight: bold; }
    </style>
</head>
<body>

    <div id="screen-login" class="screen active">
        <h1>CINEPALETTE</h1>
        <p class="subtitle">The Cinephile Quiz</p>
        
        <input type="text" id="username" placeholder="Kullanƒ±cƒ± Adƒ±">
        
        <div style="border-top: 1px solid #333; border-bottom: 1px solid #333; padding: 20px 0; margin: 20px 0;">
            <h3 style="margin:0 0 15px 0; color:#fff; font-size:14px;">YENƒ∞ OYUN KUR</h3>
            
            <label>ZORLUK SEVƒ∞YESƒ∞</label>
            <select id="difficulty-select">
                <option value="easy">üçø KOLAY (Gi≈üe Filmleri)</option>
                <option value="hard">üé¨ ZOR (K√ºlt & Modern Klasikler)</option>
                <option value="expert">üç∑ √áOK ZOR (Arthouse & Sinefil)</option>
            </select>

            <label>MOD / KATEGORƒ∞</label>
            <select id="category-select">
                <option value="mix">Karƒ±≈üƒ±k (Hepsi)</option>
                <option value="director">Y√∂netmen E≈üle≈ütirme</option>
                <option value="poster_blur">Bulanƒ±k Posterler</option>
            </select>
            
            <button onclick="createRoom()">ODA OLU≈ûTUR</button>
        </div>

        <input type="text" id="room-code-input" placeholder="Oda Kodu Gir">
        <button onclick="joinRoom()" style="background:#333; margin-top:10px">ODAYA KATIL</button>
    </div>

    <div id="screen-lobby" class="screen">
        <h2>LOBƒ∞</h2>
        <div id="lobby-info" style="color:#888; font-size:12px; margin-bottom:10px;"></div>
        <div style="font-size: 40px; color: #e50914; font-weight: bold; letter-spacing: 5px; margin-bottom:20px" id="display-room-code">---</div>
        <ul id="player-list" style="list-style:none; padding:0; width:100%; text-align:left;"></ul>
        <div id="host-controls" style="display:none; width:100%"><button onclick="startGameByHost()">OYUNU BA≈ûLAT</button></div>
        <p id="guest-msg" style="color:#555; font-size:12px;">Host bekleniyor...</p>
    </div>

    <div id="screen-game" class="screen">
        <div class="top-bar">
            <div class="timer-box" id="game-timer">60</div>
            <div id="game-score" style="color:#aaa; padding-top:5px;">0 Puan</div>
        </div>
        
        <div class="visual-area">
            <div id="poster-wrapper">
                <img id="game-poster" src="" alt="Poster">
                <div id="no-poster-text" style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#333;">NO POSTER</div>
            </div>
            <div class="palette-column" id="palette-box"></div>
        </div>

        <div class="options-grid" id="options-box"></div>
        <div id="game-feedback" style="height:20px; font-weight:bold; margin-top:15px; color:#e50914"></div>
    </div>

    <div id="screen-result" class="screen">
        <h1>SONU√áLAR</h1>
        <table id="leaderboard-table">
            <thead><tr><th>#</th><th>ƒ∞sim</th><th>Puan</th></tr></thead>
            <tbody></tbody>
        </table>
        <button onclick="location.reload()" style="background:#333; margin-top:20px">√áIKI≈û</button>
    </div>

    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyCKXuqXEtQ_dr1FNw-8NZj0BpeoSDl_mRY",
  authDomain: "cinepalette-e7a2b.firebaseapp.com",
  databaseURL: "https://cinepalette-e7a2b-default-rtdb.firebaseio.com",
  projectId: "cinepalette-e7a2b",
  storageBucket: "cinepalette-e7a2b.firebasestorage.app",
  messagingSenderId: "933599264840",
  appId: "1:933599264840:web:667563470c4ea338f7187d"
};

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // -----------------------------------------------------------
        // GENƒ∞≈ûLETƒ∞LMƒ∞≈û & ZORLUK SEVƒ∞YELƒ∞ VERƒ∞TABANI
        // -----------------------------------------------------------
        const database = [
            // === KOLAY (EASY) ===
            { diff: "easy", cat: "scifi", colors: ["#000000", "#0D2615", "#00FF41", "#FFFFFF"], correct: "The Matrix", poster: "https://image.tmdb.org/t/p/w500/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg", options: ["The Matrix", "Hulk", "Alien", "Tron"] },
            { diff: "easy", cat: "poster_blur", colors: ["#2E86C1", "#17202A", "#2ECC71", "#FFFFFF"], correct: "Avatar", poster: "https://image.tmdb.org/t/p/w500/kyeqWdyUXW608qlYkRqosgbbJyK.jpg", options: ["Avatar", "Smurfs", "Warcraft", "Valerian"] },
            { diff: "easy", cat: "horror", colors: ["#000000", "#FFFFFF", "#E74C3C", "#2C3E50"], correct: "Scream", poster: "https://image.tmdb.org/t/p/w500/lYfHdbO1h6zVq6f4y4O4x5y5f5.jpg", options: ["Scream", "Scary Movie", "Halloween", "Saw"] },
            { diff: "easy", cat: "mix", colors: ["#E0218A", "#F5BDD6", "#40E0D0", "#FFFDD0"], correct: "Barbie", poster: "https://image.tmdb.org/t/p/w500/iuFNMS8U5cb6xf8ACc40FqAHU8l.jpg", options: ["Barbie", "Mean Girls", "Legally Blonde", "Clueless"] },
            { diff: "easy", cat: "director", colors: ["#0d1b2a", "#415a77", "#778da9", "#e0e1dd"], correct: "J. Cameron - Titanic", poster: "https://image.tmdb.org/t/p/w500/9xjZS2rlVxm8SFx8kPC3aIGCOYQ.jpg", options: ["J. Cameron - Titanic", "J. Cameron - Avatar", "M. Bay - Pearl Harbor", "Spielberg - Jaws"] },
            { diff: "easy", cat: "mix", colors: ["#F39C12", "#1B2631", "#E74C3C", "#FFFFFF"], correct: "Star Wars", poster: "https://image.tmdb.org/t/p/w500/6FfCtAuVAW8XJjZ7eWeLibRLWTw.jpg", options: ["Star Wars", "Star Trek", "Dune", "Guardians"] },
            { diff: "easy", cat: "poster_blur", colors: ["#F5B041", "#17202A", "#FFFFFF", "#3498DB"], correct: "Finding Nemo", poster: "https://image.tmdb.org/t/p/w500/eHuGQ10FUzK1mdOY69wF5pGgEf5.jpg", options: ["Finding Nemo", "Shark Tale", "Little Mermaid", "Moana"] },
            { diff: "easy", cat: "horror", colors: ["#FFFFFF", "#FF0000", "#FFFF00", "#000000"], correct: "It", poster: "https://image.tmdb.org/t/p/w500/9E2y5Q7WlCVNEhP5GiVTJhEhx1o.jpg", options: ["It", "Joker", "Clown", "Poltergeist"] },

            // === ZOR (HARD - Cult & Cinephile Starter) ===
            { diff: "hard", cat: "mix", colors: ["#F29FCD", "#581845", "#86C0D7", "#F2E9D8"], correct: "Grand Budapest Hotel", poster: "https://image.tmdb.org/t/p/w500/eWdyYQreja6JGCzqHWXpWHDrrPo.jpg", options: ["Grand Budapest Hotel", "French Dispatch", "Am√©lie", "Moonrise Kingdom"] },
            { diff: "hard", cat: "director", colors: ["#FFD700", "#000000", "#FF0000", "#FFFFFF"], correct: "Tarantino - Kill Bill", poster: "https://image.tmdb.org/t/p/w500/v7TaX8kXMXs5yGGxuzM9cMDNG5H.jpg", options: ["Tarantino - Kill Bill", "Tarantino - Pulp Fiction", "Tarantino - Django", "Rodriguez - Sin City"] },
            { diff: "hard", cat: "scifi", colors: ["#F28C0F", "#003B59", "#A67A53", "#0D0D0D"], correct: "Blade Runner 2049", poster: "https://image.tmdb.org/t/p/w500/gajva2L0rPYkEWjzgFlBXCAVBE5.jpg", options: ["Blade Runner 2049", "Dune", "Tron Legacy", "Arrival"] },
            { diff: "hard", cat: "horror", colors: ["#F1C40F", "#E67E22", "#FFFFFF", "#27AE60"], correct: "Midsommar", poster: "https://image.tmdb.org/t/p/w500/7LEI8ulZzO5gy9JwyMcP8P52lpa.jpg", options: ["Midsommar", "Hereditary", "The Witch", "The Village"] },
            { diff: "hard", cat: "poster_blur", colors: ["#1C1C1C", "#C0392B", "#F1C40F", "#ECF0F1"], correct: "The Truman Show", poster: "https://image.tmdb.org/t/p/w500/vufeL5hnPfe55W822iqC4W5L3fH.jpg", options: ["The Truman Show", "Eternal Sunshine", "Liar Liar", "Forest Gump"] },
            { diff: "hard", cat: "mix", colors: ["#D93221", "#30632A", "#F2C53D", "#000000"], correct: "Am√©lie", poster: "https://image.tmdb.org/t/p/w500/slG9XGzG2y46s5Xn7MbdM9R7Hk.jpg", options: ["Am√©lie", "Chocolat", "Midnight in Paris", "Delicatessen"] },
            { diff: "hard", cat: "director", colors: ["#922B21", "#17202A", "#F1948A", "#D7DBDD"], correct: "D. Fincher - Fight Club", poster: "https://image.tmdb.org/t/p/w500/pB8BM7pdSp6B6Ih7Qf4n6a7WOQq.jpg", options: ["D. Fincher - Fight Club", "D. Fincher - Se7en", "Guy Ritchie - Snatch", "Boyle - Trainspotting"] },
            { diff: "hard", cat: "scifi", colors: ["#F5DEB3", "#C2B280", "#8B4513", "#000000"], correct: "Dune (2021)", poster: "https://image.tmdb.org/t/p/w500/d5NXSklXo0qyIYkgV94XAgMIckC.jpg", options: ["Dune (2021)", "Mad Max", "Prometheus", "Star Wars"] },
            { diff: "hard", cat: "mix", colors: ["#000000", "#1C2833", "#F4D03F", "#FFFFFF"], correct: "Interstellar", poster: "https://image.tmdb.org/t/p/w500/gEU2QniL6C971PN668mgz8QAqQ.jpg", options: ["Interstellar", "Gravity", "The Martian", "Ad Astra"] },

            // === √áOK ZOR (EXPERT - Arthouse & Obscure) ===
            { diff: "expert", cat: "scifi", colors: ["#222", "#444", "#888", "#D35400"], correct: "Stalker (1979)", poster: "https://image.tmdb.org/t/p/w500/lQXg0l6qQZ7aJzG3B1pX6qQZ7aJ.jpg", options: ["Stalker (1979)", "Solaris", "Metropolis", "Come and See"] },
            { diff: "expert", cat: "poster_blur", colors: ["#A93226", "#17202A", "#FDFEFE", "#566573"], correct: "Persona", poster: "https://image.tmdb.org/t/p/w500/bdd8141915824184800218401555.jpg", options: ["Persona", "The Seventh Seal", "Wild Strawberries", "8¬Ω"] },
            { diff: "expert", cat: "director", colors: ["#C0392B", "#922B21", "#17202A", "#000000"], correct: "Gaspar Noe - Climax", poster: "https://image.tmdb.org/t/p/w500/47i3j3yQ9l2y2y2y2y2y2y2y2y2.jpg", options: ["Gaspar Noe - Climax", "Gaspar Noe - Enter the Void", "L. Von Trier - Antichrist", "Haneke - Funny Games"] },
            { diff: "expert", cat: "mix", colors: ["#F4D03F", "#117A65", "#922B21", "#17202A"], correct: "In the Mood for Love", poster: "https://image.tmdb.org/t/p/w500/iYyaLxLEld4V31I91d1424324.jpg", options: ["In the Mood for Love", "Chungking Express", "Fallen Angels", "Yi Yi"] },
            { diff: "expert", cat: "horror", colors: ["#5D6D7E", "#1C2833", "#99A3A4", "#FDFEFE"], correct: "The Lighthouse", poster: "https://image.tmdb.org/t/p/w500/3nk9UoepYmv1G9oP18q6JJCeYwN.jpg", options: ["The Lighthouse", "The Witch", "A Field in England", "Nosferatu"] },
            { diff: "expert", cat: "mix", colors: ["#D35400", "#F39C12", "#2E4053", "#FDFEFE"], correct: "Portrait of a Lady on Fire", poster: "https://image.tmdb.org/t/p/w500/2LqaLgk4Z226KkgPJuiOQ58wvjj.jpg", options: ["Portrait of a Lady on Fire", "Blue is the Warmest Color", "Carol", "Petite Maman"] },
            { diff: "expert", cat: "director", colors: ["#FFFFFF", "#F39C12", "#D35400", "#000000"], correct: "Jodorowsky - Holy Mountain", poster: "https://image.tmdb.org/t/p/w500/3Z2F3J551143413.jpg", options: ["Jodorowsky - Holy Mountain", "Jodorowsky - El Topo", "Fellini - Satyricon", "Pasolini - Salo"] },
            { diff: "expert", cat: "scifi", colors: ["#B03A2E", "#17202A", "#FDFEFE", "#5D6D7E"], correct: "2001: A Space Odyssey", poster: "https://image.tmdb.org/t/p/w500/ve72VxNqjGM69Uky4WTo2bK6rfq.jpg", options: ["2001: A Space Odyssey", "Solaris", "Moon", "Sunshine"] }
        ];

        // --- DEƒûƒ∞≈ûKENLER ---
        let myName="", myRoomCode="", myId="", isHost=false;
        let gameQuestions = [];
        let currentQIndex = 0;
        let score = 0;
        let timerInterval;
        let totalTime = 60;
        let isPlaying = false;

        // --- SAYFA Y√ñNETƒ∞Mƒ∞ ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        function generateCode() { return Math.floor(1000 + Math.random() * 9000).toString(); }
        
        // --- ODA ---
        function createRoom() {
            myName = document.getElementById('username').value.trim();
            const diff = document.getElementById('difficulty-select').value;
            const cat = document.getElementById('category-select').value;
            
            if(!myName) return alert("ƒ∞sim gir!");
            myRoomCode = generateCode(); isHost = true;
            
            db.ref('rooms/' + myRoomCode).set({ 
                status: "lobby", 
                difficulty: diff,
                category: cat, 
                createdAt: Date.now() 
            });
            joinMyOwnRoom();
        }

        function joinRoom() {
            myName = document.getElementById('username').value.trim();
            myRoomCode = document.getElementById('room-code-input').value.trim();
            if(!myName || !myRoomCode) return alert("Bilgiler eksik!");
            
            db.ref('rooms/' + myRoomCode).get().then(snap => {
                if(snap.exists() && snap.val().status === "lobby") joinMyOwnRoom();
                else alert("Oda yok veya oyun ba≈ülamƒ±≈ü!");
            });
        }

        function joinMyOwnRoom() {
            const ref = db.ref(`rooms/${myRoomCode}/players`).push();
            myId = ref.key;
            ref.set({ name: myName, score: 0, status: "waiting" });
            setupLobby();
        }

        function setupLobby() {
            showScreen('screen-lobby');
            document.getElementById('display-room-code').innerText = myRoomCode;
            if(isHost) document.getElementById('host-controls').style.display = 'block';
            else document.getElementById('guest-msg').style.display = 'block';

            const roomRef = db.ref('rooms/' + myRoomCode);
            
            roomRef.child('players').on('value', snap => {
                const list = document.getElementById('player-list'); list.innerHTML = '';
                if(snap.val()) Object.values(snap.val()).forEach(p => {
                    list.innerHTML += `<li>${p.name} <span style="float:right; color:#e50914">${p.score} P</span></li>`;
                });
            });

            roomRef.once('value').then(snap => {
                const d = snap.val().difficulty.toUpperCase();
                const c = snap.val().category.toUpperCase();
                document.getElementById('lobby-info').innerText = `MOD: ${d} | ${c}`;
            });

            roomRef.child('status').on('value', snap => {
                if(snap.val() === 'playing') {
                    roomRef.once('value').then(all => startGame(all.val()));
                } else if(snap.val() === 'finished') showResults();
            });
        }

        function startGameByHost() { db.ref('rooms/' + myRoomCode).update({ status: "playing" }); }

        // -----------------------------------------------------------
        // OYUN MOTORU
        // -----------------------------------------------------------
        function startGame(roomData) {
            const diff = roomData.difficulty;
            const cat = roomData.category;

            // 1. ZORLUƒûA G√ñRE Fƒ∞LTRELE
            let pool = database.filter(q => q.diff === diff);
            
            // 2. KATEGORƒ∞YE G√ñRE Fƒ∞LTRELE (Eƒüer 'mix' deƒüilse)
            if(cat !== 'mix') {
                const strictPool = pool.filter(q => q.cat === cat);
                // Eƒüer o kategoride yeterince soru yoksa, o zorluktaki t√ºm sorularƒ± kullan (Fallback)
                if(strictPool.length >= 3) pool = strictPool; 
            }

            gameQuestions = pool.sort(() => Math.random() - 0.5);
            
            if(gameQuestions.length === 0) { 
                alert("Bu filtrede soru bulunamadƒ±! Veritabanƒ±nƒ± kontrol edin."); 
                return; 
            }

            // S√ºre Ayarƒ± (Y√∂netmen modu daha zor olduƒüu i√ßin +30sn)
            totalTime = (cat === 'director') ? 90 : 60;
            
            showScreen('screen-game');
            currentQIndex = 0; score = 0; isPlaying = true;
            
            startGlobalTimer();
            loadQuestion();
        }

        function startGlobalTimer() {
            const el = document.getElementById('game-timer');
            el.innerText = totalTime;
            el.classList.remove('critical');
            
            timerInterval = setInterval(() => {
                totalTime--;
                el.innerText = totalTime;
                if(totalTime <= 10) el.classList.add('critical');
                if(totalTime <= 0) finishGame();
            }, 1000);
        }

        function loadQuestion() {
            // Sorular biterse ba≈üa sar
            if(currentQIndex >= gameQuestions.length) currentQIndex = 0;

            const q = gameQuestions[currentQIndex];
            
            // G√ñRSELLER
            const posterImg = document.getElementById('game-poster');
            // √ñnce posteri gizle (Flash'ƒ± engellemek i√ßin)
            posterImg.classList.remove('revealed');
            
            // Resmi y√ºkle
            posterImg.src = q.poster || ""; // Eƒüer link yoksa bo≈ü
            
            // RENKLER
            const pBox = document.getElementById('palette-box');
            pBox.innerHTML = '';
            q.colors.forEach(c => {
                const d = document.createElement('div');
                d.className = 'color-box'; d.style.backgroundColor = c;
                pBox.appendChild(d);
            });

            // ≈ûIKLAR
            const oBox = document.getElementById('options-box');
            oBox.innerHTML = '';
            document.getElementById('game-feedback').innerText = '';
            
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn'; 
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, q.correct, btn);
                oBox.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btn) {
            if(!isPlaying) return;
            
            // Butonlarƒ± kilitle
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

            if(selected === correct) {
                score += 10;
                document.getElementById('game-score').innerText = score + " Puan";
                btn.classList.add('correct');
                document.getElementById('game-feedback').innerText = "DOƒûRU!";
                
                // Sƒ∞Hƒ∞R BURADA: POSTERƒ∞ NETLE≈ûTƒ∞R
                document.getElementById('game-poster').classList.add('revealed');
                
                setTimeout(() => { if(isPlaying) { currentQIndex++; loadQuestion(); } }, 1500);
            } else {
                btn.classList.add('wrong');
                document.getElementById('game-feedback').innerText = "YANLI≈û!";
                setTimeout(() => { if(isPlaying) { currentQIndex++; loadQuestion(); } }, 500);
            }
        }

        function finishGame() {
            isPlaying = false;
            clearInterval(timerInterval);
            db.ref(`rooms/${myRoomCode}/players/${myId}`).update({ score: score, status: "finished" });
            
            // Sonu√ß ekranƒ±na ge√ßme ama bekleme yap
            document.getElementById('options-box').innerHTML = '<h3 style="color:#fff">S√úRE DOLDU!</h3>';
            
            // Herkes bitti mi kontrol et
            const ref = db.ref(`rooms/${myRoomCode}/players`);
            ref.on('value', snap => {
                const arr = Object.values(snap.val());
                const finished = arr.filter(p => p.status === "finished").length;
                if(isHost && finished === arr.length) {
                    setTimeout(() => db.ref('rooms/' + myRoomCode).update({ status: "finished" }), 2000);
                }
            });
        }

        function showResults() {
            showScreen('screen-result');
            const tbody = document.querySelector('#leaderboard-table tbody'); tbody.innerHTML = '';
            db.ref(`rooms/${myRoomCode}/players`).once('value').then(snap => {
                const arr = Object.values(snap.val());
                arr.sort((a, b) => b.score - a.score);
                arr.forEach((p, i) => {
                    tbody.innerHTML += `<tr><td>${i+1}</td><td>${p.name}</td><td>${p.score}</td></tr>`;
                });
            });
        }
    </script>
</body>
</html>